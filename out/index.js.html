<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Node.js 的事件类
 *
 * @external EventEmitter
 * @see {@link https://nodejs.org/api/events.html}
 */
var EventEmitter = require('eventemitter3');

/**
 * 信鸽 Cordova 服务类，用于注册。
 *
 * @class
 * @extends external:EventEmitter
 * @param {function} exec - cordova 插件接口
 * @tutorial README.md
 */
function XGPush(exec) {
  EventEmitter.call(this);
  this.exec = exec;
  this.registerPush();
  this.registerReceiver(
    this.eventSuccess.bind(this),
    this.eventError.bind(this)
  );
}

XGPush.prototype = new EventEmitter();

XGPush.SERVICE = 'XGPush';
XGPush.ACTION_REGISTER_PUSH = 'registerpush';
XGPush.ACTION_UNREGISTER_PUSH = 'unregisterpush';
XGPush.ACTION_ADD_LISTENER = 'addlistener';

XGPush.prototype.eventSuccess = function(results) {
  console.log('receive message:', results);
  this.emit('textmessage', results);
};

XGPush.prototype.eventError = function(err) {
  console.log('receive error:', err);
  this.emit('error', err);
};

XGPush.prototype.registerReceiver = function(success, error) {
  var exec = this.exec;
  exec(
    success, error,
    XGPush.SERVICE, XGPush.ACTION_ADD_LISTENER,
    []
  );
};

/**
 * 与信鸽服务注册。注册的时候可以填别名，按照别名发送时，只有经过注册的别名才会收到推送。
 *
 * 可以重复调用这个方法。如果变更别名，则替换原有注册的结果。
 *
 * @param  {string} [alias] - 设备的别名
 * @return {external:Promise} 判断是否成功的 Promise
 * @example
 * // 直接注册
 * xgpush.registerPush().then(function() {
 *   console.log('success');
 *
 * }).catch(function(errCode) {
 *   console.log('oh no: ' + errCode);
 * });
 *
 * // 带设备别名注册
 * xgpush.registerPush('foo').then(function() {
 *   console.log('success');
 *
 * }).catch(function(errCode) {
 *   console.log('oh no: ' + errCode);
 * });
 */
XGPush.prototype.registerPush = function(alias) {
  var exec = this.exec;
  return new Promise(function(resolve, reject) {
    exec(
      resolve, reject,
      XGPush.SERVICE, XGPush.ACTION_REGISTER_PUSH,
      [alias]
    );
  });
};

/**
 * 取消注册
 *
 * @return {external:Promise} 完成后的回调
 */
XGPush.prototype.unregisterPush = function() {
  var exec = this.exec;
  return new Promise(function(resolve, reject) {
    exec(
      resolve, reject,
      XGPush.SERVICE, XGPush.ACTION_UNREGISTER_PUSH,
    []);
  });
};

/**
 * 事件的处理回调
 *
 * @callback XGPush#EventListener
 * @param {event} e - 事件内容
 */

/**
 * 收到信鸽消息时的事件
 *
 * @event XGPush#textmessage
 * @property {string} content - 消息正文内容
 * @property {Object} customContent - 消息自定义 key-value
 * @property {string} title - 消息标题
 */

module.exports = XGPush;
window._XGPush = XGPush;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Externals</h3><ul><li><a href="external-EventEmitter.html">EventEmitter</a></li></ul><h3>Classes</h3><ul><li><a href="XGPush.html">XGPush</a></li></ul><h3>Events</h3><ul><li><a href="XGPush.html#event:textmessage">textmessage</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-README.html">README</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.1</a> on Fri Jul 03 2015 19:23:23 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
